(this["webpackJsonpscreen-record-react"]=this["webpackJsonpscreen-record-react"]||[]).push([[0],{136:function(e,t,n){e.exports=n(155)},142:function(e,t,n){},143:function(e,t,n){},145:function(e,t,n){},155:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(51),i=n.n(o),c=(n(141),n(142),n(9)),s=n(10),l=n(52),u=n(14),d=n(13),p=(n(143),{addToStorage:function(e,t){t=t.toString(),window.localStorage.setItem(e,t)},getFromStorage:function(e){return window.localStorage.getItem(e)},removeFromStorage:function(e){return window.localStorage.removeItem(e)}}),h="LOGIN_TOKEN";var m=n(12),f=n.n(m),g=n(26),b=window.location.origin+"/records-manager";function v(){return(v=Object(g.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(b+"/login/"+t,{method:"POST"});case 2:return n=e.sent,e.next=5,n.text();case 5:return a=e.sent,console.log(a),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={loginValue:void 0},a.handleLoginChange=a.handleLoginChange.bind(Object(l.a)(a)),a.submit=a.submit.bind(Object(l.a)(a)),a}return Object(s.a)(n,[{key:"handleLoginChange",value:function(e){this.setState(Object.assign({},{loginValue:e.target.value}))}},{key:"submit",value:function(e){e.preventDefault(),function(e){return v.apply(this,arguments)}(this.state.loginValue).then((function(e){return p.addToStorage(h,e)})).then(this.props.onLoginUpdate)}},{key:"render",value:function(){return r.a.createElement("div",null,"Welcome, please log in to continue:",r.a.createElement("div",null,r.a.createElement("input",{type:"text",onChange:this.handleLoginChange}),r.a.createElement("button",{onClick:this.submit,disabled:!this.state.loginValue},"Submit")))}}]),n}(r.a.Component);n(145);function E(e){return y.apply(this,arguments)}function y(){return(y=Object(g.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getDisplayMedia(t.exportDiaplaMediaConstraints());case 4:if(n=e.sent,!t.grabMic){e.next=10;break}return e.next=8,navigator.mediaDevices.getUserMedia({video:!1,audio:!0});case 8:a=e.sent,n.addTrack(a.getAudioTracks()[0]);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("Error: "+e.t0);case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}var j={AUTO:{width:0,height:0,label:"Auto"},SMALL:{width:600,height:400,label:"600x400"},MEDIUM:{width:1280,height:720,label:"1280x720"}},w=function(){function e(){Object(c.a)(this,e),this.size=j.AUTO}return Object(s.a)(e,[{key:"exportDiaplaMediaConstraints",value:function(){return{video:this._size===j.AUTO||{width:this._size.width,height:this._size.height},audio:this._audio&&{echoCancellation:this._echoCancellation,noiseSuppression:this._noiseSuppression},grabMic:this._grabMic}}},{key:"size",get:function(){return this._size},set:function(e){this._size=e}},{key:"audio",get:function(){return this._audio},set:function(e){this._audio=e}},{key:"echoCancellation",get:function(){return this._echoCancellation},set:function(e){this._echoCancellation=e}},{key:"noiseSuppression",get:function(){return this._noiseSuppression},set:function(e){this._noiseSuppression=e}},{key:"grabMic",get:function(){return this._grabMic},set:function(e){this._grabMic=e}}]),e}(),k=n(170),C=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.isChecked,a=t.label;return r.a.createElement(k.a.Checkbox,{label:a,checked:!!n,onChange:function(){return e.props.onChange(!n)}})}}]),n}(r.a.Component),S=n(168),_=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getRadioButtonsGroup",value:function(e,t,n,a){return Object.keys(t).map((function(o){var i=t[o],c=i[n];return r.a.createElement(k.a.Field,{control:S.a,key:c+"_radio",onChange:function(){return a(i)},value:c,checked:e===i,label:c})}))}},{key:"render",value:function(){var e=this.props,t=e.value,n=e.values,a=e.labelField,r=e.onChange;return this.getRadioButtonsGroup(t,n,a,r)}}]),n}(r.a.Component),R=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onFieldChange=function(t){var n=Object.assign(new w,e.props.constraints,t);e.props.onConstraintsChange(Object.assign({},{constraints:n}))},e}return Object(s.a)(n,[{key:"render",value:function(){var e=this,t=this.props.constraints;return r.a.createElement(k.a,null,r.a.createElement(k.a.Group,{inline:!0},r.a.createElement(_,{onChange:function(t){return e.onFieldChange({size:t})},value:t.size,values:j,labelField:"label"})),r.a.createElement(k.a.Group,{inline:!0},r.a.createElement(C,{onChange:function(t){return e.onFieldChange({grabMic:t})},isChecked:t.grabMic,label:"Grab mic"}),r.a.createElement(C,{onChange:function(t){return e.onFieldChange({audio:t})},isChecked:t.audio,label:"Grab audio"}),t.audio&&r.a.createElement(C,{onChange:function(t){return e.onFieldChange({noiseSuppression:t})},isChecked:t.noiseSuppression,label:"Noise Suppression"}),t.audio&&r.a.createElement(C,{onChange:function(t){return e.onFieldChange({echoCancellation:t})},isChecked:t.echoCancellation,label:"Echo Cancellation"})))}}]),n}(r.a.Component),U=function(){function e(t){Object(c.a)(this,e),this._stream=t}return Object(s.a)(e,[{key:"start",value:function(){var e=this;this._rec=new MediaRecorder(this._stream),this._data=[],this._rec.ondataavailable=function(t){e._data.push(t.data)},this._rec.start()}},{key:"stop",value:function(){var e=this,t=new Promise((function(t,n){e._rec.onstop=t,e._rec.onerror=n}));return this._rec.stop(),this._stream.getTracks().forEach((function(e){return e.stop()})),t.then((function(){return new Blob(e._data,{type:"video/webm"})}))}},{key:"data",get:function(){return this._data}}]),e}();function x(e){var t=e.headers||{};return t.jwt_token=p.getFromStorage(h),Object.assign(e,{headers:t})}function F(){return(F=Object(g.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(b+"/records",x({method:"GET"}));case 2:return t=e.sent,e.next=5,t.json();case 5:return n=e.sent,console.log(n),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return(L=Object(g.a)(f.a.mark((function e(t){var n,a,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),e.next=4,fetch(b+"/records",x({method:"post",body:n}));case 4:return a=e.sent,e.next=7,a.text();case 7:return r=e.sent,console.log(r),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=n(169),P=n(176),T=n(177),D=n(171),N=function(e,t){var n=document.createElement("a");n.download=t,n.href=e,n.click()},B=n(172),G=n(75),z=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"getFileRows",value:function(e){var t=this;return e.map((function(e){return r.a.createElement(D.a.Row,{key:e.name+"_table_row"},r.a.createElement(D.a.Cell,{key:e.name+"_table_cell_name"},e.name),r.a.createElement(D.a.Cell,{key:e.name+"_table_cell_button_download"},r.a.createElement(B.a,{icon:!0,labelPosition:"right",key:e.name+"_table_cell_download_button",onClick:function(){return N(e.url,e.name)}},"Download",r.a.createElement(G.a,{name:"download",key:e.name+"_table_cell_download_icon"}))),r.a.createElement(D.a.Cell,{key:e.name+"_table_cell_button_play"},r.a.createElement(B.a,{icon:!0,labelPosition:"right",key:e.name+"_table_cell_play_button",onClick:function(){return t.props.play(e)}},"Load",r.a.createElement(G.a,{name:"play",color:"green",key:e.name+"_table_cell_play_icon"}))))}))}},{key:"render",value:function(){var e=this.props.files;return r.a.createElement(D.a,{celled:!0},r.a.createElement(D.a.Header,null,r.a.createElement(D.a.Row,null,r.a.createElement(D.a.HeaderCell,null,"Files"),r.a.createElement(D.a.HeaderCell,null),r.a.createElement(D.a.HeaderCell,null))),r.a.createElement(D.a.Body,null,this.getFileRows(e)))}}]),n}(r.a.Component),A=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).uploadingOn=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.setState(Object.assign({},a.state,{uploading:!0}));case 1:case"end":return e.stop()}}),e)}))),a.uploadingOff=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.setState(Object.assign({},a.state,{uploading:!1}));case 1:case"end":return e.stop()}}),e)}))),a.upload=function(){a.uploadingOn().then((function(){return function(e){return L.apply(this,arguments)}(new File([a.props.currentRecord],a.state.filename+".webm")).then(a.props.onNewFileUpload)})).finally(a.uploadingOff)},a.handleFilenameChange=function(e){a.setState(Object.assign({},a.state,{filename:e.target.value}))},a.state={filename:"",uploading:!1},a}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props,t=e.isRecording,n=e.currentRecordUrl,a=e.startRecording,o=e.stopRecording,i=this.state.filename;return r.a.createElement(k.a.Group,null,r.a.createElement(k.a.Button,{onClick:a},"Record"),r.a.createElement(k.a.Button,{onClick:o,disabled:!t},"Stop"),n&&r.a.createElement("div",null,r.a.createElement(k.a.Input,{onChange:this.handleFilenameChange,value:i,label:"File name",required:!0}),r.a.createElement(B.a.Group,null,r.a.createElement(k.a.Button,{icon:"download",id:"downloadRecord",onClick:function(){return N(n,i)},disabled:!n||!i},"Download"),r.a.createElement(B.a.Or,{text:"or"}),r.a.createElement(k.a.Button,{onClick:this.upload,target:"_blank",disabled:!n||!i,loading:this.state.uploading},"Upload"))))}}]),n}(r.a.Component),I=n(175),H=n(174),J=n(106),V=n.n(J),W=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).videoElem=r.a.createRef(),a}return Object(s.a)(n,[{key:"shouldComponentUpdate",value:function(e,t,n){return!V()(e,this.props)}},{key:"componentDidMount",value:function(){var e=this.props.videoSourceProps,t=e.recordUrl,n=e.lastRec,a=e.record;this.videoElem.current.srcObject=null,this.videoElem.current.src="",t?this.videoElem.current.src=t:n?this.videoElem.current.src=window.URL.createObjectURL(a):this.videoElem.current.srcObject=this.props.mediaStream}},{key:"componentDidUpdate",value:function(e,t){if(!V()(e.videoSourceProps,this.props.videoSourceProps)){var n=this.props.videoSourceProps,a=n.recordUrl,r=n.lastRec,o=n.record;this.videoElem.current.srcObject=null,this.videoElem.current.src="",a?this.videoElem.current.src=a:r?this.videoElem.current.src=window.URL.createObjectURL(o):this.videoElem.current.srcObject=this.props.mediaStream}if(!V()(e.playerProps.videoSourceProps,this.props.playerProps)){var i=this.props.playerProps,c=i.play,s=i.pause,l=i.stop,u=i.muted;c&&this.videoElem.current.play(),s&&this.videoElem.current.pause(),l&&(this.videoElem.current.pause(),this.videoElem.current.currentTime=0),this.videoElem.current.muted=u}!function(e){if(e.srcObject){var t=e.srcObject.getVideoTracks()[0];console.debug("Track settings:"),console.debug(JSON.stringify(t.getSettings(),null,2)),console.debug("Track constraints:"),console.debug(JSON.stringify(t.getConstraints(),null,2));var n=e.srcObject.getAudioTracks()[0];n&&(console.debug("Track settings:"),console.debug(JSON.stringify(n.getSettings(),null,2)),console.debug("Track constraints:"),console.debug(JSON.stringify(n.getConstraints(),null,2)))}}(this.videoElem.current)}},{key:"render",value:function(){var e=this.props,t=e.width,n=void 0===t?550:t,a=e.height,o=void 0===a?400:a;return r.a.createElement("video",{id:"video",loop:!0,ref:this.videoElem,width:n,height:o,title:"main vid"})}}]),n}(r.a.Component),q=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).play=function(e){e.preventDefault(),a.setState(Object.assign({},a.state,{play:!0,pause:!1,stop:!1}))},a.pause=function(e){e.preventDefault(),a.setState(Object.assign({},a.state,{play:!1,pause:!0,stop:!1}))},a.stop=function(e){e.preventDefault(),a.setState(Object.assign({},a.state,{play:!1,pause:!1,stop:!0}))},a.toggleMuted=function(e){e.preventDefault(),a.setState(Object.assign({},a.state,{muted:!a.state.muted}))},a.state={play:!1,pause:!1,stop:!0,muted:!1},a}return Object(s.a)(n,[{key:"getPlaceholder",value:function(e,t){return"Recording"===e?r.a.createElement(I.a,{icon:!0},r.a.createElement(G.a,{name:"record",color:"red"}),"Recording"):e>0&&e<=3?r.a.createElement(H.a,null,r.a.createElement(H.a.Value,null,e)):t?r.a.createElement(I.a,{icon:!0},r.a.createElement(G.a,{name:"file video",color:"grey"})):void 0}},{key:"render",value:function(){var e=this.props,t=e.videoSourceProps,n=e.placeholder,a=this.state,o=a.play,i=a.pause,c=a.stop,s=a.muted,l=!Object.values(t).find((function(e){return null!==e})),u=r.a.createElement(W,{videoSourceProps:t,playerProps:Object.assign({},this.state)});return r.a.createElement("div",null,r.a.createElement(P.a,{placeholder:!0},(l||n)&&this.getPlaceholder(n,l),!l&&!n&&u),r.a.createElement(P.a,null,r.a.createElement(B.a,{icon:!0,onClick:this.play,disabled:l||o},r.a.createElement(G.a,{name:"play",color:"green"})),r.a.createElement(B.a,{icon:!0,onClick:this.pause,disabled:l||i||c},r.a.createElement(G.a,{name:"pause",color:"grey"})),r.a.createElement(B.a,{icon:!0,onClick:this.stop,disabled:l||c},r.a.createElement(G.a,{name:"stop",color:"grey"})),r.a.createElement(B.a,{icon:!0,onClick:this.toggleMuted},s?r.a.createElement(G.a,{name:"volume off",color:"grey"}):r.a.createElement(G.a,{name:"volume up",color:"grey"}))))}}]),n}(r.a.Component),K=function(e){return new Promise((function(t){return setTimeout(t,e)}))},$=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).loadFileList=function(){(function(){return F.apply(this,arguments)})().then((function(e){a.setState(Object.assign({},a.state,{files:e}))}))},a.stopRecording=function(){a.state.recorder&&a.state.recorder.stop().then((function(e){a.setState(Object.assign({},a.state,{mediaStream:null,recorder:null,currentRecord:e,currentRecordUrl:URL.createObjectURL(e)}))}))},a.countdown=Object(g.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1e3,e.abrupt("return",K(1).then((function(){return a.setState(Object.assign({},a.state,{countdown:3}))})).then((function(){return K(1e3)})).then((function(){return a.setState(Object.assign({},a.state,{countdown:2}))})).then((function(){return K(1e3)})).then((function(){return a.setState(Object.assign({},a.state,{countdown:1}))})).then((function(){return K(1e3)})).then((function(){return a.setState(Object.assign({},a.state,{countdown:0}))})));case 2:case"end":return e.stop()}}),e)}))),a.startRecording=Object(g.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(a.state.constraints);case 2:(t=e.sent)&&(n=new U(t),a.countdown().then((function(){n.start(),a.setState(Object.assign({},a.state,{mediaStream:t,recorder:n,currentRecord:null,currentRecordUrl:null}))})));case 4:case"end":return e.stop()}}),e)}))),a.onHitPlay=function(e){a.setState({mediaStream:null,constraints:new w,recorder:null,currentRecord:e,currentRecordUrl:e.url,files:a.state.files})},a.onConstraintsChange=function(e){a.setState(Object.assign({},a.state,e))},a.onNewFileUpload=function(){a.loadFileList()},a.state={mediaStream:null,constraints:new w,recorder:null,currentRecord:null,currentRecordUrl:null,files:null,countdown:0},a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.loadFileList()}},{key:"render",value:function(){var e,t=this.state,n=t.mediaStream,a=t.currentRecord,o=t.currentRecordUrl,i=t.constraints,c=t.files,s=t.countdown,l=t.recorder;return s>0?e=s:l&&(e="Recording"),r.a.createElement(M.a,null,r.a.createElement(P.a,null,r.a.createElement(T.a,{divided:"vertically"},r.a.createElement(T.a.Row,{columns:2},r.a.createElement(T.a.Column,{width:9},r.a.createElement(q,{videoSourceProps:{mediaStream:n,record:a,recordUrl:o},placeholder:e}),r.a.createElement(P.a,null,r.a.createElement(k.a,null,r.a.createElement(R,{onConstraintsChange:this.onConstraintsChange,constraints:i}),r.a.createElement(A,{isRecording:!!n,currentRecord:a,currentRecordUrl:o,stopRecording:this.stopRecording,startRecording:this.startRecording,onNewFileUpload:this.onNewFileUpload})))),c&&r.a.createElement(T.a.Column,{width:5},r.a.createElement(z,{files:c,play:this.onHitPlay}))))))}}]),n}(r.a.Component),Q=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(c.a)(this,n),a=t.call(this,e);var r=!!p.getFromStorage(h);return a.state={loginSuccess:r},a.onLoginUpdate=a.onLoginUpdate.bind(Object(l.a)(a)),a}return Object(s.a)(n,[{key:"onLoginUpdate",value:function(){var e=!!p.getFromStorage(h);this.setState(Object.assign({},{loginSuccess:e}))}},{key:"render",value:function(){var e=this.state.loginSuccess;return r.a.createElement(M.a,null,e?r.a.createElement($,null):r.a.createElement(O,{onLoginUpdate:this.onLoginUpdate}))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(152).config(),i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[136,1,2]]]);
//# sourceMappingURL=main.cf2674dd.chunk.js.map